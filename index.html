<!DOCTYPE html>
<html>
  <head>
    <title>Nova NEET Calculator</title>
    <link rel="stylesheet" href="style.css">

    <!--  DELETE <style> LATER. AFTER STYLE.CSS  -->
    <style>
      .screen {
        display: none;
      }
      .screen.active {
        display: block;
      }
      button {
        padding: 15px;
        margin: 10px;
        font-size: 16px;
      }
    </style>
    <!--  DELETE <style> LATER. AFTER STYLE.CSS  -->
        
  </head>

  <body>
    <!-- HOME SCREEN -->
    <div id="home" class="screen active">
      <h1>NEET Calculator</h1>
      <h2>What do you want to do?</h2>
      <button onclick="startNewTest()">Calculate Marks</button>
      <button onclick="showScreen('history')">View Previous Tests' Marks</button>
      <button onclick="exportTests()">üì§ Export Tests</button>
      <button onclick="importTests()">üì• Import Tests</button>
      <p>PS: Please don't clear your browser data. The tests are saved locally in your browser.</p>
    </div>

    <!-- CALCULATE SCREEN -->
    <div id="calculate" class="screen">
        <h2>Welcome to the Test Score Calculator</h2>
        
        <label>
            Test Name:
            <input id="testName" type="text" placeholder="Mastery 1.1 / AITS 5">
        </label>
        <br><br>

        <label id="editRemarkWrapper" style="display:none;">
            Edit Remark:
            <input id="editRemark" type="text"
                placeholder="Why are you editing this test?">
        </label>


        <label>
            Test Type:
            <select id="testType">
                <option value="major">Major (720)</option>
                <option value="minor">Minor (400)</option>
            </select>
        </label>

        <br><br>


        <label>
            Physics Correct:
            <input id="phyC" type="number" min="0" max="45" required>
        </label>
        <br>

        <label>
            Physics Wrong:
            <input id="phyW" type="number" min="0" max="45" required>
        </label>
        <br><br>

        <label>
            Chemistry Correct:
            <input id="chemC" type="number" min="0" max="45" required>
        </label>
        <br>

        <label>
            Chemistry Wrong:
            <input id="chemW" type="number" min="0" max="45" required>
        </label>

        <br><br>

        <label>
            Botany Correct:
            <input id="botC" type="number" min="0" max="45" required>
        </label>
        <br>

        <label>
            Botany Wrong:
            <input id="botW" type="number" min="0" max="45" required>
        </label>
        <br><br>

        <label>
            Zoology Correct:
            <input id="zooC" type="number" min="0" max="45" required>
        </label>
        <br>

        <label>
            Zoology Wrong:
            <input id="zooW" type="number" min="0" max="45" required>
        </label>


        <p id="phyResult"></p>
        <p id="chemResult"></p>
        <p id="botResult"></p>
        <p id="zooResult"></p>
        <p id="totalResult"></p>
        <p id="percentageResult"></p>
        <p id="equivalentResult"></p>
        <p id="metaInfo"></p>
        <p id="remarkDisplay" style="display:none;"></p>
        <button onclick="calculatePhysics()">Get Physics Marks</button>
        <button onclick="calculateChemistry()">Get Chemistry Marks</button>
        <button onclick="calculateBotany()">Get Botany Marks</button>
        <button onclick="calculateZoology()">Get Zoology Marks</button>
        <button onclick="calculateTotal()">Get Total Marks</button>
        <button onclick="saveTest()" id="saveBtn">Save Score</button>

        <!-- VIEW MODE BUTTONS -->
        <button onclick="enterEditMode()" id="editBtn">‚úèÔ∏è Edit</button>
        <button onclick="deleteCurrentTest()" id="deleteBtn">üóëÔ∏è Delete</button>
        
        <button onclick="showScreen('home')">‚¨Ö Back</button>

    </div>


    <!-- HISTORY SCREEN -->
    <div id="history" class="screen">
      <h2>Previous Marks</h2>
      <div id="historyList"></div>
      <button onclick="showScreen('home')">‚¨Ö Back</button>
    </div>

    <!-- SCRIPTS -->
    <script>
        let currentViewingTest = null;

        function showScreen(screenId) {
            document.querySelectorAll(".screen").forEach(function (screen) {
                screen.classList.remove("active");
            });
            document.getElementById(screenId).classList.add("active");

            // üÜï If creating a new test, start in EDIT mode
            if (screenId === "calculate" && currentViewingTest === null) {
                enterEditMode();
            }


            if (screenId === "history") {
                loadHistory();
            }
        }


        function readInputs() {
            const name = document.getElementById("testName").value;
            const phyC = document.getElementById("phyC").value;
            const phyW = document.getElementById("phyW").value;

            alert(
                "Test: " + name +
                "\nPhysics Correct: " + phyC +
                "\nPhysics Wrong: " + phyW
            );
        }

        function getMaxMarks() {
            const type = document.getElementById("testType").value;
            return type === "minor" ? 400 : 720;
        }

        function getMaxQuestions() {
            const type = document.getElementById("testType").value;
            return type === "minor" ? 25 : 45;
        }

        function calculatePhysics() {
            const phyC = Number(document.getElementById("phyC").value) || 0;
            const phyW = Number(document.getElementById("phyW").value) || 0;

            const maxQ = getMaxQuestions();

            if (phyC + phyW > maxQ) {
                document.getElementById("phyResult").innerText =
                    "‚ùå Physics questions cannot exceed " + maxQ;
                return;
            }

            const score = phyC * 4 - phyW;

            const subjectMax = getMaxQuestions() * 4;

            document.getElementById("phyResult").innerText =
                "Physics score: " + score + " / " + subjectMax;

        }

        function calculateChemistry() {
            const chemC = Number(document.getElementById("chemC").value) || 0;
            const chemW = Number(document.getElementById("chemW").value) || 0;

            const maxQ = getMaxQuestions();

            if (chemC + chemW > maxQ) {
                document.getElementById("chemResult").innerText =
                    "‚ùå Chemistry questions cannot exceed " + maxQ;
                return;
            }

            const score = chemC * 4 - chemW;

            const subjectMax = getMaxQuestions() * 4;

            document.getElementById("chemResult").innerText =
                "Chemistry score: " + score + " / " + subjectMax;
        }
        
        function calculateBotany() {
            const botC = Number(document.getElementById("botC").value) || 0;
            const botW = Number(document.getElementById("botW").value) || 0;

            const maxQ = getMaxQuestions();

            if (botC + botW > maxQ) {
                document.getElementById("botResult").innerText =
                    "‚ùå Botany questions cannot exceed " + maxQ;
                return;
            }

            const score = botC * 4 - botW;

            const subjectMax = getMaxQuestions() * 4;

            document.getElementById("botResult").innerText =
                "Botany score: " + score + " / " + subjectMax;
        }
        
        function calculateZoology() {
            const zooC = Number(document.getElementById("zooC").value) || 0;
            const zooW = Number(document.getElementById("zooW").value) || 0;

            const maxQ = getMaxQuestions();

            if (zooC + zooW > maxQ) {
                document.getElementById("zooResult").innerText =
                    "‚ùå Zoology questions cannot exceed " + maxQ;
                return;
            }

            const score = zooC * 4 - zooW;

            const subjectMax = getMaxQuestions() * 4;

            document.getElementById("zooResult").innerText =
                "Zoology score: " + score + " / " + subjectMax;
        }

        function calculateTotal() {
            const fields = [
                "phyC","phyW",
                "chemC","chemW",
                "botC","botW",
                "zooC","zooW"
            ];

            for (let id of fields) {
                if (document.getElementById(id).value === "") {
                    document.getElementById("totalResult").innerText =
                        "‚ö†Ô∏è Please fill all fields before calculating total.";
                    return;
                }
            }

            const phyC = Number(document.getElementById("phyC").value) || 0;
            const phyW = Number(document.getElementById("phyW").value) || 0;

            const chemC = Number(document.getElementById("chemC").value) || 0;
            const chemW = Number(document.getElementById("chemW").value) || 0;

            const botC = Number(document.getElementById("botC").value) || 0;
            const botW = Number(document.getElementById("botW").value) || 0;

            const zooC = Number(document.getElementById("zooC").value) || 0;
            const zooW = Number(document.getElementById("zooW").value) || 0;

            const phyScore = phyC * 4 - phyW;
            const chemScore = chemC * 4 - chemW;
            const botScore = botC * 4 - botW;
            const zooScore = zooC * 4 - zooW;

            const total = phyScore + chemScore + botScore + zooScore;

            const maxMarks = getMaxMarks();

            document.getElementById("totalResult").innerText =
                "Total score: " + total + " / " + maxMarks;
            
            const percentage = (total / maxMarks) * 100;

            document.getElementById("percentageResult").innerText =
                "Percentage: " + percentage.toFixed(2) + "%";

            if (maxMarks === 400) {
                const equivalent720 = (total / 400) * 720;

                document.getElementById("equivalentResult").innerText =
                    "Equivalent NEET score: " + Math.round(equivalent720) + " / 720";
            } else {
                document.getElementById("equivalentResult").innerText = "";
            }
        }

        function saveTest() {
            const testName = document.getElementById("testName").value || "Untitled Test";
            const testType = document.getElementById("testType").value;
            const now = new Date().toISOString();

            const rawData = {
                phyC: Number(document.getElementById("phyC").value),
                phyW: Number(document.getElementById("phyW").value),
                chemC: Number(document.getElementById("chemC").value),
                chemW: Number(document.getElementById("chemW").value),
                botC: Number(document.getElementById("botC").value),
                botW: Number(document.getElementById("botW").value),
                zooC: Number(document.getElementById("zooC").value),
                zooW: Number(document.getElementById("zooW").value)
            };

            const logs = JSON.parse(localStorage.getItem("neetLogs")) || [];

            // üÜï NEW TEST MODE
            if (currentViewingTest === null) {
                const newTest = {
                    id: Date.now(),
                    testName,
                    testType,
                    version: 1,
                    createdAt: now,
                    updatedAt: now,
                    rawData
                };

                logs.push(newTest);
                localStorage.setItem("neetLogs", JSON.stringify(logs));

                // üëá IMPORTANT: switch to viewing this saved test
                currentViewingTest = newTest;
                enterViewMode();

                alert("‚úÖ Test saved successfully");
                return;
            }

            
            // Confirm before updating existing test
            const confirmUpdate = confirm(
                "Are you sure you want to update this test?\nThis will create a new version."
            );

            if (!confirmUpdate) return;

            // ‚úèÔ∏è EDIT MODE
            const index = logs.findIndex(
                (log) => log.id === currentViewingTest.id
            );

            if (index === -1) {
                alert("‚ùå Error: test not found");
                return;
            }

            logs[index] = {
                ...logs[index],
                testName,
                testType,
                version: logs[index].version + 1,
                updatedAt: now,
                editRemark: document.getElementById("editRemark").value || "",
                rawData
            };


            localStorage.setItem("neetLogs", JSON.stringify(logs));
            currentViewingTest = logs[index];

            alert("üîÑ Test updated successfully");
        }


        function loadHistory() {
            const list = document.getElementById("historyList");
            list.innerHTML = "";

            const logs = JSON.parse(localStorage.getItem("neetLogs")) || [];

            if (logs.length === 0) {
                list.innerText = "No saved tests yet.";
                return;
            }

            logs.forEach((log) => {
                const btn = document.createElement("button");

                const date = new Date(log.createdAt).toLocaleDateString();

                btn.innerText = log.testName + " (" + date + ")";
                btn.onclick = function () {
                    openSavedTest(log);
                };
                list.appendChild(btn);
            });
        }

        function openSavedTest(log) {
            currentViewingTest = log;

            document.getElementById("testName").value = log.testName;
            document.getElementById("testType").value = log.testType;
            document.getElementById("editRemark").value = log.editRemark || "";

            document.getElementById("phyC").value = log.rawData.phyC;
            document.getElementById("phyW").value = log.rawData.phyW;

            document.getElementById("chemC").value = log.rawData.chemC;
            document.getElementById("chemW").value = log.rawData.chemW;

            document.getElementById("botC").value = log.rawData.botC;
            document.getElementById("botW").value = log.rawData.botW;

            document.getElementById("zooC").value = log.rawData.zooC;
            document.getElementById("zooW").value = log.rawData.zooW;

            showScreen("calculate");

            calculatePhysics();
            calculateChemistry();
            calculateBotany();
            calculateZoology();
            calculateTotal();

            const created = new Date(log.createdAt).toLocaleString();
            const updated = new Date(log.updatedAt).toLocaleString();

            document.getElementById("metaInfo").innerText =
                "Saved: " + created +
                " | Updated: " + updated +
                " | v" + log.version;
            
            // Show remark in VIEW MODE
            if (log.editRemark) {
                document.getElementById("remarkDisplay").innerText =
                    "Remark: " + log.editRemark;
                document.getElementById("remarkDisplay").style.display = "block";
            } else {
                document.getElementById("remarkDisplay").style.display = "none";
            }

            // üîÅ Mark that we are editing an existing test
            document.querySelector(
                "button[onclick='saveTest()']"
            ).innerText = "Update Score";
            enterViewMode();
        }

        function startNewTest() {
            currentViewingTest = null;
            resetCalculateScreen();
            showScreen("calculate");
        }


        function resetCalculateScreen() {
            document.getElementById("remarkDisplay").style.display = "none";

            // Clear inputs
            document.querySelectorAll("#calculate input")
                .forEach(el => {
                    el.value = "";
                    el.disabled = false;
                });

            // Reset dropdown
            document.getElementById("testType").value = "major";

            // Clear text outputs
            [
                "phyResult","chemResult","botResult","zooResult",
                "totalResult","percentageResult","equivalentResult","metaInfo"
            ].forEach(id => {
                document.getElementById(id).innerText = "";
            });

            // Force EDIT MODE visuals
            enterEditMode();

            document.getElementById("editRemark").value = "";
        }

        function enterViewMode() {
            // Lock inputs
            document.querySelectorAll("#calculate input, #calculate select")
                .forEach(el => el.disabled = true);

            // Hide calculate + save/update buttons
            document.getElementById("saveBtn").style.display = "none";
            document.querySelectorAll(
                "button[onclick^='calculate']"
            ).forEach(btn => btn.style.display = "none");

            // Show view-mode buttons
            document.getElementById("editBtn").style.display = "inline-block";
            document.getElementById("deleteBtn").style.display = "inline-block";
        }

        function enterEditMode() {
            // Unlock inputs
            document.querySelectorAll("#calculate input, #calculate select")
                .forEach(el => el.disabled = false);

            // Show calculate + save/update buttons
            document.getElementById("saveBtn").style.display = "inline-block";
            document.querySelectorAll(
                "button[onclick^='calculate']"
            ).forEach(btn => btn.style.display = "inline-block");

            // Hide view-mode buttons
            document.getElementById("editBtn").style.display = "none";
            document.getElementById("deleteBtn").style.display = "none";

            // Set correct button label
            if (currentViewingTest === null) {
                document.getElementById("saveBtn").innerText = "Save Score";
            } else {
                document.getElementById("saveBtn").innerText = "Update Score";
            }
            
            // Show remark input only when editing existing test
            if (currentViewingTest !== null) {
                document.getElementById("editRemarkWrapper").style.display = "block";
            } else {
                document.getElementById("editRemarkWrapper").style.display = "none";
            }

            document.getElementById("remarkDisplay").style.display = "none";
        }

        function deleteCurrentTest() {
            if (!currentViewingTest) {
                alert("‚ùå No test selected to delete.");
                return;
            }

            const confirmDelete = confirm(
                `Delete "${currentViewingTest.testName}"?\nThis cannot be undone.`
            );

            if (!confirmDelete) return;

            const logs = JSON.parse(localStorage.getItem("neetLogs")) || [];

            const updatedLogs = logs.filter(
                log => log.id !== currentViewingTest.id
            );

            localStorage.setItem("neetLogs", JSON.stringify(updatedLogs));

            currentViewingTest = null;

            resetCalculateScreen();
            showScreen("history");

            alert("üóëÔ∏è Test deleted");
        }

        function exportTests() {
            const data = localStorage.getItem("neetLogs");

            if (!data) {
                alert("No tests to export.");
                return;
            }

            const blob = new Blob([data], { type: "application/json" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement("a");
            a.href = url;
            a.download = "neet-tests-backup.json";
            a.click();

            URL.revokeObjectURL(url);
        }

        function importTests() {
            const input = document.createElement("input");
            input.type = "file";
            input.accept = "application/json";

            input.onchange = function (e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function () {
                    try {
                        JSON.parse(reader.result); // validate JSON
                        const confirmImport = confirm(
                            "This will REPLACE all existing tests.\nContinue?"
                        );
                        if (!confirmImport) return;

                        localStorage.setItem("neetLogs", reader.result);
                        alert("‚úÖ Tests imported successfully");
                        showScreen("history");
                    } catch {
                        alert("‚ùå Invalid file");
                    }
                };
                reader.readAsText(file);
            };

            input.click();
        }




  
    </script>
  </body>
</html>